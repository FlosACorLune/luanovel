{% extends 'manga/base.html' %}

{% block content %}
<div class="manga-detail-container">
    <!-- Левая панель с обложкой и кнопками -->
    <aside class="manga-sidebar">
        <!-- Обложка -->
        <div class="manga-cover-large">
            <img src="{{ manga.cover_url }}" alt="{{ manga.title }}">
        </div>

        <!-- Кнопки действий -->
        <button class="action-button primary" onclick="startReading()">
            Start Read
        </button>

        <button class="action-button secondary" onclick="toggleBookmark()">
            Add to Bookmark
        </button>
    </aside>

    <!-- Правая панель с информацией -->
    <div class="manga-content">
        <!-- Заголовок -->
        <h1 class="manga-detail-title">{{ manga.title }}</h1>

        <!-- Описание -->
        <div class="manga-description">
            <p>{{ manga.description }}</p>
        </div>

        <!-- Панель глав -->
        <div class="chapters-panel">
            <div class="chapters-header">
                <span class="chapters-label">Chapters</span>
                <input type="text" placeholder="Find num" class="chapter-search">
            </div>

            <!-- Список глав -->
            <div class="chapters-list">
                {% for chapter in chapters %}
                <a href="/reader/{{ chapter.id }}/" class="chapter-item">
                    <span class="chapter-volume">Volume {{ chapter.volume }} Chapter {{ chapter.number|floatformat:"-1" }}</span>
                    <span class="chapter-date">{{ chapter.created_at|date:"Y-m-d" }}</span>
                </a>
                {% empty %}
                <div class="no-chapters">Главы не найдены</div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>


<script>
    function startReading() {
        const firstChapter = document.querySelector('.chapter-item');

        if (firstChapter) {
            window.location.href = firstChapter.getAttribute('href');
        } else {
            alert('Нет доступных глав');
        }
    }

    function toggleBookmark() {
        // TODO: Добавить логику добавления в закладки
        alert('Функция закладок будет добавлена позже');
    }

    // Поиск глав
    document.querySelector('.chapter-search').addEventListener('input', function (e) {
        const query = e.target.value.toLowerCase().trim();
        const items = document.querySelectorAll('.chapter-item');

        items.forEach(item => {
            // Ищем текст только внутри информационных блоков, чтобы избежать лишнего шума
            const content = item.textContent.toLowerCase();

            if (content.includes(query)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}